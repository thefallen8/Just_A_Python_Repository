pipeline {
    agent any
    environment {
        // Initialize environment variables for global use
        SVN_URL = ''
        BRANCH = ''
    }
    stages {
        stage('Extract Information') {
            steps {
                script {
                    // Define and parse the payload
                    def json = readJSON text: '{"ref": "refs/heads/feature/Branch_20240722_123048_082", "repository": {"svn_url": "https://github.com/thefallen8/Just_A_Python_Repository"}}'
                    
                    // Extract svn_url and ref
                    def svnUrl = json.repository.svn_url
                    def ref = json.ref
                    
                    // Extract branch from ref
                    def branch = ref.split('/')[2..-1].join('/')
                    
                    // Set the extracted values as global environment variables
                    env.SVN_URL = svnUrl
                    env.BRANCH = branch
                    
                    // Print the results
                    echo "Repository URL: ${env.SVN_URL}"
                    echo "Branch: ${env.BRANCH}"
                }
            }
        }
        stage('Use Global Variables') {
            steps {
                script {
                    // Access and use the global environment variables
                    echo "Using SVN_URL: ${env.SVN_URL}"
                    echo "Using BRANCH: ${env.BRANCH}"
                    
                    // Perform operations with SVN_URL and BRANCH
                    def finalUrl = "${env.SVN_URL}/tree/${env.BRANCH}"
                    echo "Final URL: ${finalUrl}"
                }
            }
        }
    }
    post {
        always {
            // This block runs after all stages are complete
            echo "Pipeline completed. SVN_URL: ${env.SVN_URL}, BRANCH: ${env.BRANCH}"
        }
    }
}
